@using ReactiveUI
@inherits NonAutoRenderingView<JobDetailDisplayViewModel>

<MudContainer>
    <MudGrid>
        <MudItem lg="12">
            <MudText Align="Align.Center" Typo="Typo.h3">Job Informationen</MudText>
        </MudItem>
        <StateAwaiter State="State">
            @if (context != null)
            {
                <MudItem lg="12">
                    <MudPaper Class="ma-1 pa-3">
                        <MudGrid>
                            <MudItem lg="3">
                                <MudButton OnClick="@(() => _navigationManager.NavigateTo($"/EditJob/{context.Id.Value}"))">Editieren</MudButton>
                            </MudItem>
                            <MudItem lg="2" Class="m-1">
                                <MudText Align="Align.End" Typo="Typo.h3">Job:</MudText>
                            </MudItem>
                            <MudItem lg="7" Class="m-1">
                                <MudText Align="Align.Start" Typo="Typo.h3">@context.JobName.Value</MudText>
                            </MudItem>
                            <MudItem lg="5" Class="m-1">
                                <MudText Align="Align.End" Typo="Typo.h5">Termin:</MudText>
                            </MudItem>
                            <MudItem lg="7" Class="m-1">
                                <MudText Align="Align.Start" Typo="Typo.h5">@(context.Deadline?.Value.ToLocalTime().ToString("d") ?? "Kein Termin Gesetzt")</MudText>
                            </MudItem>
                            <MudItem lg="5" Class="m-1">
                                <MudText Align="Align.End" Typo="Typo.h5">Status:</MudText>
                            </MudItem>
                            <MudItem lg="7" Class="m-1">
                                <MudText Align="Align.Start" Typo="Typo.h5">@JobTranslator.GetString(context.Status)</MudText>
                            </MudItem>
                        </MudGrid>
                    </MudPaper>
                </MudItem>
                <MudItem lg="12">
                    <MudPaper Class="ma-1 pa-3">
                        @if (context.ProjectFiles.Count > 0)
                        {
                            <MudGrid>
                                @foreach (var file in context.ProjectFiles)
                                {
                                    <MudItem lg="12" @key="file.Value">
                                        <FileDetailDisplay FileId="file"/>
                                    </MudItem>
                                }
                            </MudGrid>
                        }
                        else
                        {
                            <MudText Typo="Typo.body1" Align="Align.Center">Keine Dateien Hochgeladen</MudText>
                        }
                    </MudPaper>
                </MudItem>
            }
            else
            {
                <MudItem lg="12">
                    <MudText Align="Align.Center" Typo="Typo.h3">Keine Daten Verfügbar</MudText>
                </MudItem>
            }
        </StateAwaiter>
    </MudGrid>
</MudContainer>

@code {
    protected override JobDetailDisplayViewModel CreateModel() => Services.GetRequiredService<JobDetailDisplayViewModel>();

    protected override void InitializeModel()
    {
        this.WhenActivated(dispo =>
                           {
                                if(ViewModel == null) return;
                               
                               this.BindCommand()
                           });
    }

}
